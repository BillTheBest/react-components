define(function(a){"use strict";var b=a("third-party/eventEmitter"),c=a("lodash"),d=a("RequestHandler"),e=c.merge(b.prototype,{requestData:function(a,b,c){var e=this.collection[a];d.request(e.url,b,function(a){e.onDataReceived(a),c()},function(){e.errorFunction(),c(!0)})},emitChange:function(a){var b=Array.prototype.slice.call(arguments,1);b.unshift("change"),this.emit.apply(this,b),null!==a&&void 0!==a&&(b[0]="change:"+a,this.emit.apply(this,b))},emitFail:function(a){var b=Array.prototype.slice.call(arguments,1);b.unshift("fail"),this.emit.apply(this,b),null!==a&&void 0!==a&&(b[0]="fail:"+a,this.emit.apply(this,b))},shouldHandleAction:function(a){return c.isString(this.componentType)?a===this.componentType:c.isArray(this.componentType)?c.contains(this.componentType,a):!0},handleRequestDataAction:function(a){var b=a.id;this.shouldHandleAction(a.component)&&(c.find(this.collection,b)||this.collection[b]||this.createInstance(b,a.data.definition,a.data.dataFormatter),"REQUEST_DATA"===a.actionType&&this.requestData(b,a.data.filters,c.bind(function(a){a?this.emitFail(b):this.emitChange(b)},this)))}});return e});